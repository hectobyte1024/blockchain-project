<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduNet Blockchain Explorer - Real Blockchain Data</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f5f5f5; 
            line-height: 1.6;
        }
        
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo { 
            font-size: 24px; 
            font-weight: bold; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-badge {
            background: #10b981;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .explorer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .card h3 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: #059669;
            margin: 10px 0;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        .hash-display {
            font-family: 'Courier New', monospace;
            background: #f3f4f6;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            word-break: break-all;
            margin: 5px 0;
        }
        
        .transaction-table, .block-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .transaction-table th, .transaction-table td,
        .block-table th, .block-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transaction-table th, .block-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .status-confirmed { color: #10b981; font-weight: bold; }
        .status-pending { color: #f59e0b; font-weight: bold; }
        .status-failed { color: #ef4444; font-weight: bold; }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 0 0;
            transition: transform 0.2s;
        }
        
        .btn:hover { transform: translateY(-2px); }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .mining-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .mining-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .real-data-badge {
            background: #dc2626;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            margin-left: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">
                ‚õìÔ∏è EduNet Blockchain Explorer
                <span class="status-badge">PRODUCTION</span>
                <span class="real-data-badge">REAL ECDSA</span>
            </div>
            <div>
                <button class="btn btn-small" onclick="window.location.href='/dashboard'">Dashboard</button>
                <button class="btn btn-small" onclick="refreshAllData()">üîÑ Refresh</button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <!-- Network Statistics -->
        <div class="explorer-grid">
            <div class="card">
                <h3>üìä Network Status</h3>
                <div class="metric-value" id="block-height">Loading...</div>
                <div class="metric-label">Current Block Height</div>
                <div class="metric-value" id="peer-count" style="font-size: 20px; margin-top: 15px;">-</div>
                <div class="metric-label">Connected Peers</div>
            </div>
            
            <div class="card">
                <h3>‚õèÔ∏è Mining Information</h3>
                <div class="metric-value" id="difficulty">Loading...</div>
                <div class="metric-label">Network Difficulty</div>
                <div class="metric-value" id="hash-rate" style="font-size: 20px; margin-top: 15px;">-</div>
                <div class="metric-label">Hash Rate</div>
            </div>
            
            <div class="card">
                <h3>üí∞ Economics</h3>
                <div class="metric-value" id="total-supply">Loading...</div>
                <div class="metric-label">Total EDU Supply</div>
                <div class="metric-value" id="mempool-count" style="font-size: 20px; margin-top: 15px;">-</div>
                <div class="metric-label">Pending Transactions</div>
            </div>
        </div>
        
        <!-- Latest Block -->
        <div class="card">
            <h3>üì¶ Latest Block <span class="real-data-badge">REAL BLOCKCHAIN</span></h3>
            <div id="latest-block">
                <div class="loading">Loading latest block from blockchain...</div>
            </div>
        </div>
        
        <!-- Recent Transactions -->
        <div class="card">
            <h3>üìú Recent Transactions <span class="real-data-badge">ECDSA SIGNED</span></h3>
            <div id="recent-transactions">
                <div class="loading">Loading real transactions with ECDSA signatures...</div>
            </div>
        </div>
        
        <!-- Mempool Activity -->
        <div class="card">
            <h3>üîÑ Mempool Activity <span class="real-data-badge">LIVE DATA</span></h3>
            <div id="mempool-transactions">
                <div class="loading">Loading pending transactions from mempool...</div>
            </div>
        </div>
        
        <!-- Mining Status -->
        <div class="mining-status" id="mining-status" style="display: none;">
            <div class="mining-indicator"></div>
            <div>
                <strong>Mining Active:</strong> 
                <span id="mining-address">Processing transactions with ECDSA validation...</span>
            </div>
        </div>
    </div>
    
    <script>
        console.log('üöÄ EduNet Blockchain Explorer - REAL DATA MODE');
        
        let refreshInterval;
        let networkData = {};
        
        // Initialize explorer
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìä Initializing real blockchain explorer...');
            loadAllData();
            
            // Auto-refresh every 10 seconds
            refreshInterval = setInterval(loadAllData, 10000);
        });
        
        async function loadAllData() {
            console.log('üîÑ Loading real blockchain data...');
            
            try {
                await Promise.all([
                    loadNetworkStatus(),
                    loadLatestBlock(),
                    loadRecentTransactions(),
                    loadMempoolActivity()
                ]);
                
                console.log('‚úÖ All real blockchain data loaded');
            } catch (error) {
                console.error('‚ùå Error loading blockchain data:', error);
            }
        }
        
        async function loadNetworkStatus() {
            try {
                const response = await fetch('/api/blockchain/network-status');
                const data = await response.json();
                
                if (data.success) {
                    networkData = data;
                    
                    // Update network statistics
                    document.getElementById('block-height').textContent = data.block_height || '0';
                    document.getElementById('peer-count').textContent = data.peer_count || '0';
                    document.getElementById('difficulty').textContent = (data.difficulty || 1).toFixed(2);
                    document.getElementById('hash-rate').textContent = data.hash_rate || '0 H/s';
                    document.getElementById('mempool-count').textContent = data.pending_tx || '0';
                    
                    // Update mining status
                    if (data.is_mining) {
                        document.getElementById('mining-status').style.display = 'flex';
                        document.getElementById('mining-address').textContent = 
                            `Active - ${data.blocks_mined || 0} blocks mined`;
                    } else {
                        document.getElementById('mining-status').style.display = 'none';
                    }
                    
                    console.log('üìä Network status updated:', data);
                } else {
                    throw new Error(data.message || 'Failed to get network status');
                }
            } catch (error) {
                console.error('‚ùå Network status error:', error);
                showErrorInElement('block-height', 'Error loading network data');
            }
        }
        
        async function loadLatestBlock() {
            try {
                // For now, show network data in block format
                // TODO: Implement specific latest block endpoint
                const blockHtml = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <strong>Block Height:</strong> ${networkData.block_height || 'Loading...'}
                            <div class="hash-display" style="margin-top: 10px;">
                                <strong>Block Hash:</strong><br>
                                ${networkData.best_block_hash || 'Loading block hash...'}
                            </div>
                        </div>
                        <div>
                            <strong>Total Work:</strong> ${networkData.total_work || 'Calculating...'}
                            <br><strong>Difficulty:</strong> ${networkData.difficulty || 'Loading...'}
                            <br><strong>Blockchain Type:</strong> ${networkData.blockchain_type || 'Production'}
                        </div>
                    </div>
                `;
                
                document.getElementById('latest-block').innerHTML = blockHtml;
                console.log('üì¶ Latest block info updated');
            } catch (error) {
                console.error('‚ùå Latest block error:', error);
                document.getElementById('latest-block').innerHTML = 
                    '<div style="color: #ef4444;">Error loading latest block</div>';
            }
        }
        
        async function loadRecentTransactions() {
            try {
                const response = await fetch('/api/blockchain/transactions/recent');
                const data = await response.json();
                
                if (data.success && data.recent_transactions) {
                    let transactionsHtml = '';
                    
                    if (data.recent_transactions.length === 0) {
                        transactionsHtml = `
                            <div style="text-align: center; padding: 20px; color: #6b7280;">
                                üì≠ No transactions yet<br>
                                <small>Start by sending EDU tokens or mining blocks to see real ECDSA-signed transactions here.</small>
                            </div>
                        `;
                    } else {
                        transactionsHtml = `
                            <table class="transaction-table">
                                <thead>
                                    <tr>
                                        <th>Hash</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Block</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        data.recent_transactions.forEach(tx => {
                            const statusClass = tx.status === 'Confirmed' ? 'status-confirmed' : 
                                              tx.status === 'Pending' ? 'status-pending' : 'status-failed';
                            const timeAgo = new Date(tx.timestamp).toLocaleString();
                            
                            transactionsHtml += `
                                <tr>
                                    <td><code>${tx.hash.substring(0, 12)}...</code></td>
                                    <td>${tx.transaction_type}</td>
                                    <td>${tx.amount_edu.toFixed(6)} EDU</td>
                                    <td class="${statusClass}">${tx.status}</td>
                                    <td>${tx.block_height || 'Mempool'}</td>
                                    <td>${timeAgo}</td>
                                </tr>
                            `;
                        });
                        
                        transactionsHtml += '</tbody></table>';
                    }
                    
                    document.getElementById('recent-transactions').innerHTML = transactionsHtml;
                    console.log(`üìú Loaded ${data.recent_transactions.length} real transactions`);
                } else {
                    throw new Error(data.message || 'Failed to load transactions');
                }
            } catch (error) {
                console.error('‚ùå Recent transactions error:', error);
                document.getElementById('recent-transactions').innerHTML = `
                    <div style="color: #ef4444;">
                        Error loading transactions: ${error.message}
                    </div>
                `;
            }
        }
        
        async function loadMempoolActivity() {
            try {
                // For now, show mempool statistics
                // TODO: Implement specific mempool transactions endpoint
                const mempoolHtml = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">
                                ${networkData.pending_tx || 0}
                            </div>
                            <div style="color: #6b7280; font-size: 14px;">Pending Transactions</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #8b5cf6;">
                                ${networkData.mempool_bytes ? (networkData.mempool_bytes / 1024).toFixed(1) : 0} KB
                            </div>
                            <div style="color: #6b7280; font-size: 14px;">Mempool Size</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">
                                REAL ECDSA
                            </div>
                            <div style="color: #6b7280; font-size: 14px;">Signature Validation</div>
                        </div>
                    </div>
                    ${networkData.pending_tx === 0 ? `
                        <div style="text-align: center; padding: 20px; color: #6b7280; border-top: 1px solid #e5e7eb; margin-top: 20px;">
                            üí§ Mempool is empty<br>
                            <small>Send transactions to see them appear here before being mined into blocks.</small>
                        </div>
                    ` : ''}
                `;
                
                document.getElementById('mempool-transactions').innerHTML = mempoolHtml;
                console.log('üîÑ Mempool activity updated');
            } catch (error) {
                console.error('‚ùå Mempool activity error:', error);
                document.getElementById('mempool-transactions').innerHTML = 
                    '<div style="color: #ef4444;">Error loading mempool data</div>';
            }
        }
        
        function refreshAllData() {
            console.log('üîÑ Manual refresh triggered');
            loadAllData();
        }
        
        function showErrorInElement(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = 'Error';
                element.style.color = '#ef4444';
                console.error(`‚ùå ${elementId}: ${message}`);
            }
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
        
        console.log('‚õìÔ∏è EduNet Blockchain Explorer initialized - showing REAL blockchain data');
    </script>
</body>
</html>